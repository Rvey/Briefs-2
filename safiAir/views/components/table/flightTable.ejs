<div class="flex flex-col w-10/12 mx-auto mt-10">
  <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
    <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
      <form class="
          shadow
          overflow-hidden
          border-b border-gray-200
          sm:rounded-lg
          tableForm
        ">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th scope="col" class="
                  px-6
                  py-3
                  text-left text-xs
                  font-medium
                  text-gray-500
                  uppercase
                  tracking-wider
                ">
                Plan Code
              </th>
              <th scope="col" class="
                  px-6
                  py-3
                  text-left text-xs
                  font-medium
                  text-gray-500
                  uppercase
                  tracking-wider
                ">
                Departure
              </th>
              <th scope="col" class="
                  px-6
                  py-3
                  text-left text-xs
                  font-medium
                  text-gray-500
                  uppercase
                  tracking-wider
                ">
                Arrival
              </th>
              <th scope="col" class="
                  px-6
                  py-3
                  text-left text-xs
                  font-medium
                  text-gray-500
                  uppercase
                  tracking-wider
                ">
                stopover
              </th>
              <th scope="col" class="
                  px-6
                  py-3
                  text-left text-xs
                  font-medium
                  text-gray-500
                  uppercase
                  tracking-wider
                ">
                Seats
              </th>
              <th scope="col" class="
              px-6
              py-3
              text-left text-xs
              font-medium
              text-gray-500
              uppercase
              tracking-wider
            ">
            Direction
          </th>
              <th scope="col" class="relative px-6 py-3">
                <span class="sr-only">Edit</span>
              </th>
            </tr>
          </thead>

          <tbody class="bg-white divide-y divide-gray-200 tbody"></tbody>
        </table>
      </form>
    </div>
  </div>
</div>
<!-- modal -->
<form class="fixed z-10 inset-0 overflow-y-auto modal updateForm hidden">
  <div class="
      flex
      items-end
      justify-center
      min-h-screen
      pt-4
      px-4
      pb-20
      text-center
      sm:block sm:p-0
    ">
    <div class="fixed inset-0 bg-gray-500 bg-opacity-75" aria-hidden="true"></div>

    <!-- This element is to trick the browser into centering the modal contents. -->
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>

    <div class="
        inline-block
        align-bottom
        bg-white
        rounded-lg
        text-left
        overflow-hidden
        shadow-xl
        transform
        transition-all
        sm:my-8 sm:align-middle
        max-w-lg
        w-full
      ">
      <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
        <!-- modal body  -->

        <div class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left">
          <div class="flex items-center gap-5 mb-4">
            <div class="
                mx-auto
                flex-shrink-0 flex
                items-center
                justify-center
                h-12
                w-12
                rounded-full
                bg-indigo-100
                sm:mx-0 sm:h-10 sm:w-10
              ">
              <!-- Heroicon name: outline/exclamation -->
              <%- include('../icons/flight.ejs') %>
            </div>
            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title">
              Update Flight
            </h3>
          </div>
          <!-- extra services  -->
          <div class="mt-2 ">
            <!-- departure date -->
            <div class="mt-5">departure</div>
            <div>
              <input type="date" name="dpdate" class="text-sm text-gray-900 departure_date" />
              <input type="time" name="dptime" class="text-sm text-gray-900 departure_time" />
            </div>
            <!-- arrival date -->
            <div class="mt-5">Arrival</div>
            <div>
              <input type="date" name="ardate" class="text-sm text-gray-900 arrival_date" />
              <input type="time" name="artime" class="text-sm text-gray-900 arrival_time" />
            </div>
            <!-- stopover -->
            <div class="mt-5">
              <div>stopover</div>
              <select class="stopover border rounded-md w-full">
                <option value="true">Yes</option>
                <option value="false">No</option>
              </select>
            </div>
            <!-- seats -->
            <div class="mt-5">seats</div>
            <input type="number" name="seats" class="text-sm text-gray-900 seats border rounded-md w-full" />

            <!-- direction -->
            <div class="flex justify-between mt-5">

              <div>
                <div>From</div>
                <select class="from border rounded-md p-1" name="from" value="">
                  <option value="safi">safi</option>
                  <option value="tanger">tanger</option>
                  <option value="essaouira">essaouira</option>
                </select>
              </div>
              <div>
                <div>To</div>
                <select class="to border rounded-md p-1" name="to" value="">
                  <option value="rabat">rabat</option>
                  <option value="casablanca">casablanca</option>
                  <option value="marrakech">marrakech</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse">
        <input type="button" value="update" id="" class="
            update
            w-full
            inline-flex
            justify-center
            rounded-md
            border border-transparent
            shadow-sm
            px-4
            py-2
            bg-green-500
            text-base
            font-medium
            text-white
            hover:bg-green-700
            focus:outline-none
            focus:ring-2
            focus:ring-offset-2
            focus:ring-indigo-500
            sm:ml-3 sm:w-auto sm:text-sm
          " />


        <input type="button" id="" value="delete" class="
            delete
            mt-3
            w-full
            inline-flex
            justify-center
            rounded-md
            border border-gray-300
            shadow-sm
            px-4
            py-2
            bg-red-500
            text-base text-white
            hover:bg-red-600
            focus:outline-none
            focus:ring-2
            focus:ring-offset-2
            focus:ring-indigo-500
            sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm
          " />


      </div>
    </div>
  </div>
  </div>
  <script>
    const dDate = document.querySelector('.departure_date')
    const dTime = document.querySelector('.departure_time')
    const aDate = document.querySelector('.arrival_date')
    const aTime = document.querySelector('.arrival_time')
    const stopover = document.querySelector('.stopover')
    const seats = document.querySelector('.seats')
    const selectWhere = document.querySelector('.to')
    const selectfrom = document.querySelector('.from')
    const update = document.querySelector('.update')
    const remove = document.querySelector('.delete')
    const updateForm = document.querySelector('.updateForm')


    update.addEventListener('click', e => {
      const plan = {
        seats: seats.value,
        stopover: stopover.value,
        departure_date: dDate.value,
        departure_time: dTime.value,
        arrival_date: aDate.value,
        arrival_time: aTime.value,
        where: selectWhere.value,
        from: selectfrom.value,
      }
      fetch(`http://localhost:5000/api/plan/${e.target.id}`, {
        method: 'PUT', // or 'PUT'
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(plan),
      }).then(() => updateForm.classList.add('hidden')).then(() => location.replace('/adminPanel'))
      

    
    })
    remove.addEventListener('click', e => {
      console.log(e.target.id);
      fetch(`http://localhost:5000/api/plan/${e.target.id}`, {
        method: 'DELETE',
      }).then(() => updateForm.classList.add('hidden')).then(() => location.replace('/adminPanel'))
    })
    // listen on table 
    const tbody = document.querySelector(".tbody");
    const modal = document.querySelector(".modal");
    const tableFlight = document.querySelector(".tableForm");

    tbody.addEventListener("click", (e) => {
      if (e.target.classList.contains("update"))
        // get the right data and populate the modal
        fetch(`http://localhost:5000/api/plan/${e.target.id}`)
        .then((response) => response.json())
        .then((data) => {
          dDate.value = data.departure_date,
            dTime.value = data.departure_time,
            aDate.value = data.arrival_date,
            aTime.value = data.arrival_time,
            stopover.value = data.stopover,
            seats.value = data.seats,
            selectWhere.value = data.where,
            selectfrom.value = data.from
          update.setAttribute("id", data.id);
          remove.setAttribute("id", data.id);

        }).then(() => updateForm.classList.remove('hidden'))
    })
    fetch("http://localhost:5000/api/plans")
      .then((response) => response.json())
      .then((data) =>
        data.map((plan) => {
          tbody.innerHTML += `
        
            <tr>
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-900">
                        ${plan.flightCode}
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap ">
                  <div class="flex flex-col w-min">
                    
                    <input type="date" class="text-sm text-gray-900" value="${
                      plan.departure_date
                    }"  />
                    <input type="time" class="text-sm text-gray-900" value="${
                      plan.departure_time
                    }"   />
                  </div>
                 
                </td>
                <td class="px-6 py-4 whitespace-nowrap ">
                  <div class="flex flex-col w-min">
                    
                    <input type="date" class="text-sm text-gray-900" value="${
                      plan.arrival_date
                    }" />
                    <input type="time" class="text-sm text-gray-900" value="${
                      plan.arrival_time
                    }" />
                  </div>
                 
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  ${
                    plan.stopover == "true"
                      ? `  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-green-800">
                   stop over
                  </span>`
                      : `
                  <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                   Direct flight
                  </span>
                  `
                  }
                
                </td>
                <td class="pl-8 py-4 whitespace-nowrap text-sm text-gray-500">
                 
                    
                    <input type="number" class="text-sm text-gray-900 w-min" value="${
                      plan.seats
                    }" max="20" name="seats"/>
                   
               
                  
                </td>
                <td class="pl-3 py-4 whitespace-nowrap text-sm text-gray-500">
                  ${plan.from}
                  ->
                  ${plan.where}
             </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <input
          class="
              update
              text-indigo-500
              border-indigo-600 border-[2px]
              p-1
              rounded-md
              w-[5em]
              text-center
              cursor-pointer
              hover:bg-indigo-600 hover:text-white
            "
            type="button"
            value="update"
            id="${plan.id}"
            name="update"
            />
                </td>
              </tr>
            
            `;
        })
      );
  </script>